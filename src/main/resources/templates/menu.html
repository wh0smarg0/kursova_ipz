<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kyiv Gastrobar - Меню</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f8f8;
        }
        header {
            background-color: #333;
            padding: 10px 20px;
        }
        header nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }
        header nav ul li {
            margin-right: 20px;
        }
        header nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }
        header nav ul li a.active {
            text-decoration: underline;
        }
        .menu {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .menu h1 {
            text-align: center;
            font-size: 28px;
            color: #333;
        }
        .menu-item {
            display: flex;
            margin: 10px 0;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .menu-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            margin-right: 15px;
            border-radius: 8px;
        }
        .menu-item .item-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .menu-item .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .menu-item h3 {
            font-size: 18px;
            color: #333;
            margin: 0;
        }
        .menu-item .price {
            font-weight: bold;
            color: #333;
        }
        .menu-item p {
            margin: 10px 0;
            color: #666;
            font-size: 14px;
        }
        .menu-item button {
            background-color: #333;
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            align-self: flex-start;
            margin-top: 10px;
        }
        .menu-item button:hover {
            background-color: #555;
        }
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px 0;
        }
    </style>
</head>
<body>
<header>
    <nav>
        <ul>
            <li><a href="api.html">Головна</a></li>
            <li><a href="menu.html" class="active">Меню</a></li>
            <li><a href="order.html">Замовлення</a></li>
            <li><a href="contact.html">Контакти</a></li>
        </ul>
    </nav>
</header>

<section class="menu">
    <h1>Наше Меню</h1>
    <div id="menu-items">
        <!-- Елементи меню будуть завантажені сюди -->
    </div>
</section>

<footer>
    <p>&copy; 2025 KYIV GASTROBAR. Всі права захищені.</p>
</footer>

<script>
    const selectedItems = [];

    async function fetchMenuItems() {
        try {
            const response = await fetch('http://localhost:8080/menu-items');
            if (!response.ok) {
                throw new Error('Не вдалося завантажити меню');
            }
            const menuItems = await response.json();
            localStorage.setItem('menuItems', JSON.stringify(menuItems)); // Збереження menuItems в localStorage
            const menuContainer = document.getElementById('menu-items');
            menuContainer.innerHTML = '';

            // Створення об'єкта для категорій
            const categories = {};

            // Групування страв по категоріях
            menuItems.forEach(item => {
                if (!categories[item.category]) {
                    categories[item.category] = [];
                }
                categories[item.category].push(item);
            });

            // Створення секцій для кожної категорії
            for (const [category, items] of Object.entries(categories)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.classList.add('category');
                categoryDiv.innerHTML = `<h2>${category}</h2>`;

                // Додавання страв для цієї категорії
                items.forEach(item => {
                    const menuItemDiv = document.createElement('div');
                    menuItemDiv.classList.add('menu-item');
                    menuItemDiv.innerHTML = `
                        <img src="${item.imageUrl ? 'http://localhost:8080/' + item.imageUrl : 'http://localhost:8080/images/default-image.jpg'}" alt="${item.name}">
                        <div class="item-content">
                            <div class="item-header">
                                <h3>${item.name}</h3>
                                <span class="price">${item.price} ₴</span>
                            </div>
                            <p>${item.description || 'Опис відсутній.'}</p>
                            <button onclick="addToOrder('${item.name}')">Замовити</button>
                        </div>
                    `;
                    categoryDiv.appendChild(menuItemDiv);
                });

                // Додаємо категорію до контейнера меню
                menuContainer.appendChild(categoryDiv);
            }
        } catch (error) {
            console.error('Помилка завантаження меню:', error);
        }
    }

    // Функція для додавання страви в кошик
    function addToOrder(menuItemName) {
        const selectedItems = JSON.parse(localStorage.getItem('selectedItems')) || [];
        const menuItems = JSON.parse(localStorage.getItem('menuItems')) || [];

        // Знаходимо елемент з menuItems за назвою
        const item = menuItems.find(i => i.name === menuItemName);

        if (item) {
            // Перевіряємо, чи вже є цей товар у кошику
            let existingItem = selectedItems.find(item => item.name === menuItemName);

            if (existingItem) {
                // Якщо є, збільшуємо кількість
                existingItem.quantity += 1;
            } else {
                // Якщо немає, додаємо новий елемент
                selectedItems.push({
                    name: item.name,
                    price: item.price,
                    quantity: 1
                });
            }

            // Зберігаємо новий список у localStorage
            localStorage.setItem('selectedItems', JSON.stringify(selectedItems));
        }
    }

    window.onload = fetchMenuItems;

</script>
</body>
</html>
